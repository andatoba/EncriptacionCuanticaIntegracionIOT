apiVersion: v1
kind: ConfigMap
metadata:
  name: dashboard-frontend-code
  namespace: quantum-access-control
data:
  index.html: |
    <!DOCTYPE html>
    <html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Torre del Río - Sistema de Control de Acceso Cuántico</title>
        <style>
            :root {
                --primary-color: #00417a;
                --secondary-color: #0081c9;
                --accent-color: #00aeef;
                --success-color: #28a745;
                --danger-color: #dc3545;
                --warning-color: #ffc107;
                --light-color: #f8f9fa;
                --dark-color: #343a40;
                --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                --border-radius: 8px;
            }
            
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }
            
            body {
                background-color: #f0f2f5;
                color: #333;
                line-height: 1.6;
            }
            
            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
            }
            
            .header {
                background-color: var(--primary-color);
                background-image: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
                color: white;
                padding: 20px;
                border-radius: var(--border-radius);
                margin-bottom: 30px;
                box-shadow: var(--shadow);
                position: relative;
                overflow: hidden;
            }
            
            .header::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="rgba(255,255,255,0.1)" fill-opacity="1" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,224C672,213,768,171,864,154.7C960,139,1056,149,1152,154.7C1248,160,1344,160,1392,160L1440,160L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>');
                background-position: bottom;
                background-repeat: no-repeat;
                z-index: 0;
                opacity: 0.4;
            }
            
            .header-content {
                position: relative;
                z-index: 1;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }
            
            .logo-container {
                display: flex;
                align-items: center;
            }
            
            .logo {
                width: 60px;
                height: 60px;
                margin-right: 15px;
                background-color: white;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            }
            
            .logo svg {
                width: 40px;
                height: 40px;
                fill: var(--primary-color);
            }
            
            .header-title h1 {
                font-size: 24px;
                font-weight: 600;
                margin-bottom: 5px;
            }
            
            .header-title p {
                opacity: 0.9;
                font-size: 14px;
            }
            
            .dashboard {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }
            
            .card {
                background-color: white;
                border-radius: var(--border-radius);
                padding: 20px;
                box-shadow: var(--shadow);
                transition: transform 0.3s ease, box-shadow 0.3s ease;
            }
            
            .card:hover {
                transform: translateY(-5px);
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            }
            
            .card-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 15px;
                padding-bottom: 10px;
                border-bottom: 1px solid #eee;
            }
            
            .card-header h2 {
                font-size: 18px;
                color: var(--primary-color);
            }
            
            .card-icon {
                width: 40px;
                height: 40px;
                background-color: var(--light-color);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .card-icon svg {
                width: 24px;
                height: 24px;
                fill: var(--primary-color);
            }
            
            .card-content {
                font-size: 16px;
            }
            
            .stat {
                display: flex;
                align-items: center;
                margin-bottom: 10px;
                padding: 10px;
                border-radius: var(--border-radius);
                background-color: #f8f9fa;
            }
            
            .stat-icon {
                margin-right: 10px;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                background-color: var(--accent-color);
                color: white;
            }
            
            .stat-info {
                flex-grow: 1;
            }
            
            .stat-title {
                font-size: 14px;
                color: #666;
            }
            
            .stat-value {
                font-size: 20px;
                font-weight: 600;
                color: var(--dark-color);
            }
            
            .access-log {
                max-height: 300px;
                overflow-y: auto;
            }
            
            .log-item {
                padding: 10px;
                border-bottom: 1px solid #eee;
                display: flex;
                align-items: center;
            }
            
            .log-item:last-child {
                border-bottom: none;
            }
            
            .log-status {
                width: 10px;
                height: 10px;
                border-radius: 50%;
                margin-right: 10px;
            }
            
            .log-status.success {
                background-color: var(--success-color);
            }
            
            .log-status.denied {
                background-color: var(--danger-color);
            }
            
            .log-info {
                flex-grow: 1;
            }
            
            .log-time {
                color: #888;
                font-size: 12px;
            }
            
            .log-message {
                font-size: 14px;
            }
            
            .log-id {
                font-family: 'Courier New', monospace;
                background-color: #f0f0f0;
                padding: 2px 5px;
                border-radius: 3px;
                font-size: 12px;
            }
            
            .iframe-container {
                position: relative;
                width: 100%;
                overflow: hidden;
                border-radius: var(--border-radius);
                box-shadow: var(--shadow);
                margin-top: 20px;
                height: 600px;
            }
            
            .iframe-container iframe {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                border: none;
            }
            
            .tabs {
                display: flex;
                margin-bottom: 15px;
                border-bottom: 1px solid #ddd;
            }
            
            .tab {
                padding: 10px 20px;
                cursor: pointer;
                font-weight: 500;
                transition: all 0.3s ease;
            }
            
            .tab.active {
                border-bottom: 3px solid var(--accent-color);
                color: var(--accent-color);
            }
            
            .tab-content {
                display: none;
            }
            
            .tab-content.active {
                display: block;
            }
            
            .footer {
                text-align: center;
                padding: 20px;
                margin-top: 30px;
                color: #666;
                font-size: 14px;
            }
            
            .badge {
                display: inline-block;
                padding: 3px 8px;
                border-radius: 30px;
                font-size: 12px;
                font-weight: 500;
                margin-left: 10px;
            }
            
            .badge-success {
                background-color: var(--success-color);
                color: white;
            }
            
            .badge-danger {
                background-color: var(--danger-color);
                color: white;
            }
            
            .building-info {
                padding: 15px;
                background-color: #fff;
                border-left: 4px solid var(--accent-color);
                margin-top: 20px;
                border-radius: var(--border-radius);
                box-shadow: var(--shadow);
            }
            
            .alert {
                padding: 15px;
                margin-bottom: 20px;
                border-radius: var(--border-radius);
                color: white;
                display: flex;
                align-items: center;
            }
            
            .alert-icon {
                margin-right: 15px;
            }
            
            .alert-warning {
                background-color: var(--warning-color);
            }
            
            .alert-danger {
                background-color: var(--danger-color);
            }
            
            .alert-success {
                background-color: var(--success-color);
            }
            
            @media (max-width: 768px) {
                .dashboard {
                    grid-template-columns: 1fr;
                }
                
                .header-content {
                    flex-direction: column;
                    text-align: center;
                }
                
                .logo-container {
                    margin-bottom: 15px;
                }
                
                .tab {
                    padding: 8px 15px;
                    font-size: 14px;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <div class="header-content">
                    <div class="logo-container">
                        <div class="logo">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="M12,1L3,5v6c0,5.55,3.84,10.74,9,12c5.16-1.26,9-6.45,9-12V5L12,1L12,1z M12,11.99h7c-0.53,4.12-3.28,7.79-7,8.94V12H5V6.3l7-3.11V11.99z"/>
                            </svg>
                        </div>
                        <div class="header-title">
                            <h1>Torre del Río</h1>
                            <p>Sistema de Control de Acceso Cuántico</p>
                        </div>
                    </div>
                    <div class="system-status">
                        <span class="badge badge-success">Sistema Operativo</span>
                        <div id="current-time" style="margin-top: 5px; font-size: 14px; opacity: 0.9;"></div>
                    </div>
                </div>
            </div>

            <div class="dashboard">
                <div class="card">
                    <div class="card-header">
                        <h2>Estado del Sistema</h2>
                        <div class="card-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="M17,7H7A5,5,0,0,0,2,12a5,5,0,0,0,5,5H17a5,5,0,0,0,5-5A5,5,0,0,0,17,7ZM7,15a3,3,0,1,1,3-3A3,3,0,0,1,7,15Z"/>
                            </svg>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="stat">
                            <div class="stat-icon" style="background-color: #00aeef;">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="white" viewBox="0 0 24 24">
                                    <path d="M12,21L9,18H7A2,2,0,0,1,5,16V8A2,2,0,0,1,7,6H17A2,2,0,0,1,19,8v8a2,2,0,0,1-2,2H15Z"/>
                                </svg>
                            </div>
                            <div class="stat-info">
                                <div class="stat-title">Intentos de Acceso</div>
                                <div class="stat-value" id="access-attempts">--</div>
                            </div>
                        </div>
                        <div class="stat">
                            <div class="stat-icon" style="background-color: #28a745;">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="white" viewBox="0 0 24 24">
                                    <path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"/>
                                </svg>
                            </div>
                            <div class="stat-info">
                                <div class="stat-title">Accesos Permitidos</div>
                                <div class="stat-value" id="access-success">--</div>
                            </div>
                        </div>
                        <div class="stat">
                            <div class="stat-icon" style="background-color: #dc3545;">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="white" viewBox="0 0 24 24">
                                    <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
                                </svg>
                            </div>
                            <div class="stat-info">
                                <div class="stat-title">Accesos Denegados</div>
                                <div class="stat-value" id="access-denied">--</div>
                            </div>
                        </div>
                        <div class="stat">
                            <div class="stat-icon" style="background-color: #17a2b8;">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="white" viewBox="0 0 24 24">
                                    <path d="M17.8,20C17.4,21.2 16.3,22 15,22H9C7.7,22 6.6,21.2 6.2,20H17.8M15,4A4,4 0 0,1 19,8A4,4 0 0,1 15,12H9A4,4 0 0,1 5,8A4,4 0 0,1 9,4H15M15,5.6H9C7.7,5.6 6.6,6.7 6.6,8C6.6,9.3 7.7,10.4 9,10.4H15C16.3,10.4 17.4,9.3 17.4,8C17.4,6.7 16.3,5.6 15,5.6Z"/>
                                </svg>
                            </div>
                            <div class="stat-info">
                                <div class="stat-title">Calidad de Clave Cuántica</div>
                                <div class="stat-value" id="key-quality">--</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2>Registro de Accesos</h2>
                        <div class="card-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                            </svg>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="access-log" id="access-log">
                            <div class="log-item">
                                <div class="log-status success"></div>
                                <div class="log-info">
                                    <div class="log-message">Acceso permitido - <span class="log-id">e4e0ef2a</span></div>
                                    <div class="log-time">Hoy, 10:45 AM</div>
                                </div>
                            </div>
                            <div class="log-item">
                                <div class="log-status denied"></div>
                                <div class="log-info">
                                    <div class="log-message">Acceso denegado - <span class="log-id">a1b2c3d4</span></div>
                                    <div class="log-time">Hoy, 10:30 AM</div>
                                </div>
                            </div>
                            <div class="log-item">
                                <div class="log-status success"></div>
                                <div class="log-info">
                                    <div class="log-message">Acceso permitido - <span class="log-id">0A1B2C3D</span></div>
                                    <div class="log-time">Hoy, 9:15 AM</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="building-info">
                <h3>Torre del Río - Guayaquil</h3>
                <p style="margin-top: 10px;">
                    Edificio emblemático ubicado en la Av. Malecón Simón Bolívar, cuenta con el primer sistema de control de acceso cuántico en Ecuador. 
                    La implementación utiliza el protocolo BB84 para proporcionar una seguridad sin precedentes contra ataques informáticos.
                </p>
            </div>
            
            <div class="tabs" id="dashboard-tabs">
                <div class="tab active" data-tab="prometheus">Métricas del Sistema</div>
                <div class="tab" data-tab="grafana">Panel de Control</div>
                <div class="tab" data-tab="orion">Datos en Tiempo Real</div>
            </div>
            
            <div class="tab-content active" id="prometheus-tab">
                <div class="iframe-container">
                    <iframe src="/prometheus-proxy/" id="prometheus-iframe"></iframe>
                </div>
            </div>
            
            <div class="tab-content" id="grafana-tab">
                <div class="iframe-container">
                    <iframe src="/grafana-proxy/" id="grafana-iframe"></iframe>
                </div>
            </div>
            
            <div class="tab-content" id="orion-tab">
                <div class="iframe-container">
                    <iframe src="/orion-proxy/v2/entities" id="orion-iframe"></iframe>
                </div>
            </div>
            
            <div class="footer">
                &copy; 2025 Torre del Río - Sistema de Control de Acceso Cuántico
            </div>
        </div>
        
        <script>
            // Actualizar fecha y hora actuales
            function updateTime() {
                const now = new Date();
                const options = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                };
                document.getElementById('current-time').textContent = now.toLocaleDateString('es-ES', options);
            }
            
            updateTime();
            setInterval(updateTime, 1000);
            
            // Tabs functionality
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs
                    tabs.forEach(t => t.classList.remove('active'));
                    // Add active class to clicked tab
                    tab.classList.add('active');
                    
                    // Hide all tab content
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Show the corresponding tab content
                    const tabId = tab.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // Simulación de actualización de métricas
            function updateMetrics() {
                // Simulación de datos
                const attempts = Math.floor(Math.random() * 50) + 50;
                const success = Math.floor(attempts * (Math.random() * 0.3 + 0.6)); // 60-90% éxito
                const denied = attempts - success;
                const quality = (Math.random() * 20 + 75).toFixed(1) + "%"; // 75-95% calidad
                
                document.getElementById('access-attempts').textContent = attempts;
                document.getElementById('access-success').textContent = success;
                document.getElementById('access-denied').textContent = denied;
                document.getElementById('key-quality').textContent = quality;
                
                // Actualización simulada cada 10 segundos
                setTimeout(updateMetrics, 10000);
            }
            
            // Iniciar simulación de métricas
            updateMetrics();
            
            // Simulación de logs de acceso
            function addLogEntry() {
                const log = document.getElementById('access-log');
                const success = Math.random() > 0.3; // 70% de éxito
                
                // Generar ID aleatorio
                const id = Array(8).fill().map(() => Math.floor(Math.random() * 16).toString(16)).join('');
                
                // Generar marca de tiempo aleatoria en los últimos minutos
                const now = new Date();
                const minutesAgo = Math.floor(Math.random() * 30);
                now.setMinutes(now.getMinutes() - minutesAgo);
                const timeString = minutesAgo === 0 ? 'Justo ahora' : `Hace ${minutesAgo} min`;
                
                const logItem = document.createElement('div');
                logItem.className = 'log-item';
                logItem.innerHTML = `
                    <div class="log-status ${success ? 'success' : 'denied'}"></div>
                    <div class="log-info">
                        <div class="log-message">Acceso ${success ? 'permitido' : 'denegado'} - <span class="log-id">${id}</span></div>
                        <div class="log-time">${timeString}</div>
                    </div>
                `;
                
                // Insertar al principio
                log.insertBefore(logItem, log.firstChild);
                
                // Limitar a 10 entradas
                if (log.children.length > 10) {
                    log.removeChild(log.lastChild);
                }
                
                // Próxima entrada entre 5-15 segundos
                const nextTime = Math.random() * 10000 + 5000;
                setTimeout(addLogEntry, nextTime);
            }
            
            // Iniciar simulación de logs
            setTimeout(addLogEntry, 3000);
            
            // Configurar iframes cuando las pestañas se activan
            document.querySelector('[data-tab="prometheus"]').addEventListener('click', () => {
                document.getElementById('prometheus-iframe').src = '/prometheus-proxy/';
            });
            
            document.querySelector('[data-tab="grafana"]').addEventListener('click', () => {
                document.getElementById('grafana-iframe').src = '/grafana-proxy/';
            });
            
            document.querySelector('[data-tab="orion"]').addEventListener('click', () => {
                document.getElementById('orion-iframe').src = '/orion-proxy/v2/entities';
            });
        </script>
    </body>
    </html>
  
  nginx.conf: |
    user nginx;
    worker_processes 1;
    
    events {
        worker_connections 1024;
    }
    
    http {
        include /etc/nginx/mime.types;
        default_type application/octet-stream;
        sendfile on;
        keepalive_timeout 65;
        
        server {
            listen 80;
            
            location / {
                root /usr/share/nginx/html;
                index index.html;
            }
            
            # Proxy para Prometheus
            location /prometheus-proxy/ {
                proxy_pass http://prometheus:9090/;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto $scheme;
            }
            
            # Proxy para Grafana
            location /grafana-proxy/ {
                proxy_pass http://grafana:3000/;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto $scheme;
            }
            
            # Proxy para Orion Context Broker
            location /orion-proxy/ {
                proxy_pass http://orion-context-broker:1026/;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto $scheme;
            }
        }
    }
